---
export const prerender = true;
import { sanityClient } from 'sanity:client';
import MainLayout from '../../layouts/MainLayout.astro';
import PortableText from "../../components/PortableTextComponent"
import { Icon } from 'astro-icon/components';

export async function getStaticPaths() {
  const posts = await sanityClient.fetch(
    `*[_type == "listings" && defined(slug.current)]`
  );
  return posts.map((post: any) => {
    return {
      params: {
        post_id: post.slug.current,
      },
    };
  });
}

const { post_id } = Astro.params;
const post = await sanityClient.fetch(
  `*[_type == "listings" && slug.current == $post_id][0]{
    title,
    description,
    excerpt,
    text,
    class,
    code,
    location,
    "slug": slug.current,
    "image": mainImage.asset -> url,
    "district": district -> {title,"slug": slug.current, "zone": zone -> {title,"slug": slug.current}},
    renting,
    rentPrice,
    selling,
    sellPrice,
    various
  }`,
  { post_id }
);


---

<MainLayout 
  title={post.title}
  description={post.excerpt}
  keywords={`Fine Living Immobiliare, ${post.title}, ${post.description}`}
  robots='allow'
  ogTitle={post.title}
  ogDescription={post.excerpt}
  ogType='website'
  ogUrl={`/immobili/${post.slug}`}
>
  <article class="flex flex-col mx-10 lg:mx-20 mt-20">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
      <hgroup>
        <h1 class="font-headings text-3xl">{post.title}</h1>
        <h2 class="font-text text-xl mt-2">{post.description}</h2>
      </hgroup>
      <p class="font-text text-2xl text-secondary font-semibold mt-3 lg:mt-0">
        {post.renting ? (
          <span>€ {post.rentPrice} / Mese</span>
        ) : (!post.renting && !post.selling) ? (
          <span>Su Contatto</span>
        ) : !post.renting ? (
          <span>€ {post.sellPrice}</span>
        ) : (<span>Da definire</span>)
        }
      </p>
    </div>
    <img src={post.image} alt={`Foto di: ${post.title}`} width="100" height="100" class="w-full my-5" loading="lazy" />
    <div class="my-5 grid grid-cols-2 grid-rows-2 xl:grid-rows-none xl:grid-cols-5 items-start justify-center">
      <div class=" max-w-8xl col-span-4 mr-5">
        <PortableText value={post.text} />
      </div>
      <div class="aside p-5 flex flex-col gap-10 max-w-full border justify-start items-start col-span-2 xl:col-span-1">
        <div class="p-auto w-full text-left ">
          <h3 class="font-text font-semibold mb-5 text-xl">Caratteristiche</h3>
          <ul class="flex justify-between flex-wrap gap-x-10 gap-y-5 xl:grid xl:grid-cols-2 xl:grid-rows-3 xl:gap-y-10 xl:gap-x-5">
            <li class="flex gap-2 font-text font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" ><g fill="none" fill-rule="evenodd"><><path d="M24 0v24H0V0zM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036c-.01-.003-.019 0-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z" /><path fill="currentColor" d="M7 6a1 1 0 0 1 1-1h1v1a1 1 0 0 0 2 0V5a2 2 0 0 0-2-2H8a3 3 0 0 0-3 3v5H4a2 2 0 0 0-2 2v1a5.994 5.994 0 0 0 2.625 4.961l-.332.332a1 1 0 1 0 1.414 1.414l.876-.875c.454.11.929.168 1.417.168h8c.488 0 .963-.058 1.417-.168l.876.875a1 1 0 0 0 1.414-1.414l-.332-.332A5.994 5.994 0 0 0 22 14v-1a2 2 0 0 0-2-2H7zm-3 7h16v1a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4z"/></></g></svg>
              <p>{post.various.bath}</p>
            </li>
            <li class="flex gap-2 font-text font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" ><path fill="currentColor" d="M7 14c1.66 0 3-1.34 3-3S8.66 8 7 8s-3 1.34-3 3s1.34 3 3 3m0-4c.55 0 1 .45 1 1s-.45 1-1 1s-1-.45-1-1s.45-1 1-1m12-3h-8v8H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4m2 8h-8V9h6c1.1 0 2 .9 2 2Z"/></svg>
                  <p>{post.various.rooms}</p>
            </li>
            <li class="flex gap-2 font-text font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor"><path d="M5 9.979C5 11.095 6.79 12 9 12V9.979c0-.994 0-1.492-.397-1.795c-.398-.303-.792-.19-1.58.037C5.815 8.57 5 9.226 5 9.98"/><path d="M16 8.5c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5S5.134 5 9 5s7 1.567 7 3.5"/><path d="M2 9v6.667C2 17.507 5.134 19 9 19h11c.943 0 1.414 0 1.707-.293S22 17.943 22 17v-3c0-.943 0-1.414-.293-1.707S20.943 12 20 12H9m9 7v-2m-4 2v-2m-4 2v-2m-4 1.5v-2"/></g></svg>
              <p>{post.various.area}</p>
            </li>
            <li class="flex gap-2 font-text font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M13.22 2.416a2 2 0 0 0-2.511.057l-7 5.999A2 2 0 0 0 3 10v9a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7.354"/><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8m6-15h6m-3-3v6"/></g></svg>
              <p>{post.various.constructionYear}</p>
            </li>
            <li class="flex gap-2 font-text font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256"><path fill="currentColor" d="M200 24H56a16 16 0 0 0-16 16v176a16 16 0 0 0 16 16h144a16 16 0 0 0 16-16V40a16 16 0 0 0-16-16m-48 120h48v24h-88v-24Zm8-16v-24h40v24Zm40-88v48h-48a8 8 0 0 0-8 8v32h-40a8 8 0 0 0-8 8v32H56V40Zm0 176H56v-32h144z"/></svg>
              <p>{post.various.floors}</p>
            </li>
            <li class="flex gap-2 font-text font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" ><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M11 16v-5H3m18-3h-6v2m0 8v3m-4-2v2m0-18v3m10 9h-6v-2m-4-4v2" /><path d="M21 3.6v16.8a.6.6 0 0 1-.6.6H3.6a.6.6 0 0 1-.6-.6V3.6a.6.6 0 0 1 .6-.6h16.8a.6.6 0 0 1 .6.6" /></g></svg>
              <p>{post.various.locals}</p>
            </li>   
          </ul>
        </div>
        <div class="w-sm text-left font-text font-medium">
          {post.class == "Classe Energetica A" ? (
            <p class="bg-[#33a357] px-4 py-2 rounded-md ">{post.class}</p>
            ) : post.class == "Classe Energetica B" ? (
            <p class="bg-[#79b752] px-4 py-2 rounded-md ">{post.class}</p>
            ) : post.class == "Classe Energetica C" ? (
            <p class="bg-[#c3d545] px-4 py-2 rounded-md ">{post.class}</p>
            ) : post.class == "Classe Energetica D" ? (
            <p class="bg-[#fff12c] px-4 py-2 rounded-md ">{post.class}</p>
            ) : post.class == "Classe Energetica E" ? (
            <p class="bg-[#edb731] px-4 py-2 rounded-md ">{post.class}</p>
            ) : post.class == "Classe Energetica F" ? (
            <p class="bg-[#d66f2c] px-4 py-2 rounded-md ">{post.class}</p>
            ) : post.class == "Classe Energetica G" ? (
            <p class="bg-[#cc232a] px-4 py-2 rounded-md ">{post.class}</p>
            ) : (<p class="bg-gray-300">Da Definire</p>)
          } 
        </div>
        <div class="w-full">
          <h3 class="font-text font-semibold mb-5 text-xl">Informazioni</h3>
          <ul class="flex flex-col sm:flex-row gap-y-3 gap-x-10 justify-evenly xl:flex-col">
            <li><p class="font-text font-medium">Rif. Agenzia: <span class="underline underline-offset-2 font-semibold">{post.code}</span></p></li>
            <li><p class="font-text font-medium">Posto Auto: {post.various.garage ? (<span class="underline underline-offset-2 font-semibold">Disponibile</span>) : (<span class="font-semibold">Non Disponibile</span>)}</p></li>
            <li><p class="font-text font-medium">Disponibilità: {post.various.available ? (<span class="underline underline-offset-2 font-semibold">Libero</span>) : (<span class="font-semibold">Occupato</span>)}</p></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="w-full my-20">
      <div class="mb-10">
        <h1 class="font-headings text-3xl mb-3">Ubicazione</h1>
        <p class="font-text">Per la tutela dei dati personali, la via indicata dal puntatore sulla mappa è approssimativa. </p>
      </div>
      <iframe src={post.location} width="600" height="450" style="border:0;" class="w-full" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </article>
</MainLayout>

